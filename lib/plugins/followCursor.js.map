{"version":3,"file":"followCursor.js","sources":["../../src-js/utils.js","../../src-js/dom-utils.js","../../src-js/plugins/followCursor.js"],"sourcesContent":["export function hasOwnProperty(obj, key) {\n    return {}.hasOwnProperty.call(obj, key);\n}\nexport function getValueAtIndexOrReturn(value, index, defaultValue) {\n    if (Array.isArray(value)) {\n        const v = value[index];\n        return v == null\n            ? Array.isArray(defaultValue)\n                ? defaultValue[index]\n                : defaultValue\n            : v;\n    }\n    return value;\n}\nexport function isType(value, type) {\n    const str = {}.toString.call(value);\n    return str.indexOf('[object') === 0 && str.indexOf(`${type}]`) > -1;\n}\nexport function invokeWithArgsOrReturn(value, args) {\n    return typeof value === 'function' ? value(...args) : value;\n}\nexport function debounce(fn, ms) {\n    // Avoid wrapping in `setTimeout` if ms is 0 anyway\n    if (ms === 0) {\n        return fn;\n    }\n    let timeout;\n    return (arg) => {\n        clearTimeout(timeout);\n        timeout = setTimeout(() => {\n            fn(arg);\n        }, ms);\n    };\n}\nexport function removeProperties(obj, keys) {\n    const clone = Object.assign({}, obj);\n    keys.forEach((key) => {\n        delete clone[key];\n    });\n    return clone;\n}\nexport function splitBySpaces(value) {\n    return value.split(/\\s+/).filter(Boolean);\n}\nexport function normalizeToArray(value) {\n    return [].concat(value);\n}\nexport function pushIfUnique(arr, value) {\n    if (arr.indexOf(value) === -1) {\n        arr.push(value);\n    }\n}\nexport function appendPxIfNumber(value) {\n    return typeof value === 'number' ? `${value}px` : value;\n}\nexport function unique(arr) {\n    return arr.filter((item, index) => arr.indexOf(item) === index);\n}\nexport function getNumber(value) {\n    return typeof value === 'number' ? value : parseFloat(value);\n}\nexport function getBasePlacement(placement) {\n    return placement.split('-')[0];\n}\nexport function arrayFrom(value) {\n    return [].slice.call(value);\n}\nexport function removeUndefinedProps(obj) {\n    return Object.keys(obj).reduce((acc, key) => {\n        if (obj[key] !== undefined) {\n            acc[key] = obj[key];\n        }\n        return acc;\n    }, {});\n}\n","import { arrayFrom, isType, normalizeToArray, getBasePlacement } from './utils';\nexport function div() {\n    return document.createElement('div');\n}\nexport function isElement(value) {\n    return ['Element', 'Fragment'].some((type) => isType(value, type));\n}\nexport function isNodeList(value) {\n    return isType(value, 'NodeList');\n}\nexport function isMouseEvent(value) {\n    return isType(value, 'MouseEvent');\n}\nexport function isReferenceElement(value) {\n    return !!(value && value._tippy && value._tippy.reference === value);\n}\nexport function getArrayOfElements(value) {\n    if (isElement(value)) {\n        return [value];\n    }\n    if (isNodeList(value)) {\n        return arrayFrom(value);\n    }\n    if (Array.isArray(value)) {\n        return value;\n    }\n    return arrayFrom(document.querySelectorAll(value));\n}\nexport function setTransitionDuration(els, value) {\n    els.forEach((el) => {\n        if (el) {\n            el.style.transitionDuration = `${value}ms`;\n        }\n    });\n}\nexport function setVisibilityState(els, state) {\n    els.forEach((el) => {\n        if (el) {\n            el.setAttribute('data-state', state);\n        }\n    });\n}\nexport function getOwnerDocument(elementOrElements) {\n    var _a;\n    const [element] = normalizeToArray(elementOrElements);\n    // Elements created via a <template> have an ownerDocument with no reference to the body\n    return ((_a = element === null || element === void 0 ? void 0 : element.ownerDocument) === null || _a === void 0 ? void 0 : _a.body) ? element.ownerDocument : document;\n}\nexport function isCursorOutsideInteractiveBorder(popperTreeData, event) {\n    const { clientX, clientY } = event;\n    return popperTreeData.every(({ popperRect, popperState, props }) => {\n        const { interactiveBorder } = props;\n        const basePlacement = getBasePlacement(popperState.placement);\n        const offsetData = popperState.modifiersData.offset;\n        if (!offsetData) {\n            return true;\n        }\n        const topDistance = basePlacement === 'bottom' ? offsetData.top.y : 0;\n        const bottomDistance = basePlacement === 'top' ? offsetData.bottom.y : 0;\n        const leftDistance = basePlacement === 'right' ? offsetData.left.x : 0;\n        const rightDistance = basePlacement === 'left' ? offsetData.right.x : 0;\n        const exceedsTop = popperRect.top - clientY + topDistance > interactiveBorder;\n        const exceedsBottom = clientY - popperRect.bottom - bottomDistance > interactiveBorder;\n        const exceedsLeft = popperRect.left - clientX + leftDistance > interactiveBorder;\n        const exceedsRight = clientX - popperRect.right - rightDistance > interactiveBorder;\n        return exceedsTop || exceedsBottom || exceedsLeft || exceedsRight;\n    });\n}\nexport function updateTransitionEndListener(box, action, listener) {\n    const method = `${action}EventListener`;\n    // some browsers apparently support `transition` (unprefixed) but only fire\n    // `webkitTransitionEnd`...\n    ['transitionend', 'webkitTransitionEnd'].forEach((event) => {\n        box[method](event, listener);\n    });\n}\n/**\n * Compared to xxx.contains, this function works for dom structures with shadow\n * dom\n */\nexport function actualContains(parent, child) {\n    var _a, _b;\n    let target = child;\n    while (target) {\n        if (parent.contains(target)) {\n            return true;\n        }\n        target = (_b = (_a = target.getRootNode) === null || _a === void 0 ? void 0 : _a.call(target)) === null || _b === void 0 ? void 0 : _b.host;\n    }\n    return false;\n}\n","import { getOwnerDocument, isMouseEvent } from '../dom-utils';\nlet mouseCoords = { clientX: 0, clientY: 0 };\nlet activeInstances = [];\nfunction storeMouseCoords({ clientX, clientY }) {\n    mouseCoords = { clientX, clientY };\n}\nfunction addMouseCoordsListener(doc) {\n    doc.addEventListener('mousemove', storeMouseCoords);\n}\nfunction removeMouseCoordsListener(doc) {\n    doc.removeEventListener('mousemove', storeMouseCoords);\n}\nconst followCursor = {\n    name: 'followCursor',\n    defaultValue: false,\n    fn(instance) {\n        const reference = instance.reference;\n        const doc = getOwnerDocument(instance.props.triggerTarget || reference);\n        let isInternalUpdate = false;\n        let wasFocusEvent = false;\n        let isUnmounted = true;\n        let prevProps = instance.props;\n        function getIsInitialBehavior() {\n            return (instance.props.followCursor === 'initial' && instance.state.isVisible);\n        }\n        function addListener() {\n            doc.addEventListener('mousemove', onMouseMove);\n        }\n        function removeListener() {\n            doc.removeEventListener('mousemove', onMouseMove);\n        }\n        function unsetGetReferenceClientRect() {\n            isInternalUpdate = true;\n            instance.setProps({ getReferenceClientRect: null });\n            isInternalUpdate = false;\n        }\n        function onMouseMove(event) {\n            // If the instance is interactive, avoid updating the position unless it's\n            // over the reference element\n            const isCursorOverReference = event.target\n                ? reference.contains(event.target)\n                : true;\n            const { followCursor } = instance.props;\n            const { clientX, clientY } = event;\n            const rect = reference.getBoundingClientRect();\n            const relativeX = clientX - rect.left;\n            const relativeY = clientY - rect.top;\n            if (isCursorOverReference || !instance.props.interactive) {\n                instance.setProps({\n                    // @ts-ignore - unneeded DOMRect properties\n                    getReferenceClientRect() {\n                        const rect = reference.getBoundingClientRect();\n                        let x = clientX;\n                        let y = clientY;\n                        if (followCursor === 'initial') {\n                            x = rect.left + relativeX;\n                            y = rect.top + relativeY;\n                        }\n                        const top = followCursor === 'horizontal' ? rect.top : y;\n                        const right = followCursor === 'vertical' ? rect.right : x;\n                        const bottom = followCursor === 'horizontal' ? rect.bottom : y;\n                        const left = followCursor === 'vertical' ? rect.left : x;\n                        return {\n                            width: right - left,\n                            height: bottom - top,\n                            top,\n                            right,\n                            bottom,\n                            left,\n                        };\n                    },\n                });\n            }\n        }\n        function create() {\n            if (instance.props.followCursor) {\n                activeInstances.push({ instance, doc });\n                addMouseCoordsListener(doc);\n            }\n        }\n        function destroy() {\n            activeInstances = activeInstances.filter((data) => data.instance !== instance);\n            if (activeInstances.filter((data) => data.doc === doc).length === 0) {\n                removeMouseCoordsListener(doc);\n            }\n        }\n        return {\n            onCreate: create,\n            onDestroy: destroy,\n            onBeforeUpdate() {\n                prevProps = instance.props;\n            },\n            onAfterUpdate(_, { followCursor }) {\n                if (isInternalUpdate) {\n                    return;\n                }\n                if (followCursor !== undefined &&\n                    prevProps.followCursor !== followCursor) {\n                    destroy();\n                    if (followCursor) {\n                        create();\n                        if (instance.state.isMounted &&\n                            !wasFocusEvent &&\n                            !getIsInitialBehavior()) {\n                            addListener();\n                        }\n                    }\n                    else {\n                        removeListener();\n                        unsetGetReferenceClientRect();\n                    }\n                }\n            },\n            onMount() {\n                if (instance.props.followCursor && !wasFocusEvent) {\n                    if (isUnmounted) {\n                        onMouseMove(mouseCoords);\n                        isUnmounted = false;\n                    }\n                    if (!getIsInitialBehavior()) {\n                        addListener();\n                    }\n                }\n            },\n            onTrigger(_, event) {\n                if (isMouseEvent(event)) {\n                    mouseCoords = { clientX: event.clientX, clientY: event.clientY };\n                }\n                wasFocusEvent = event.type === 'focus';\n            },\n            onHidden() {\n                if (instance.props.followCursor) {\n                    unsetGetReferenceClientRect();\n                    removeListener();\n                    isUnmounted = true;\n                }\n            },\n        };\n    },\n};\nexport default followCursor;\n"],"names":["isType","value","type","str","toString","call","indexOf","normalizeToArray","concat","isMouseEvent","getOwnerDocument","elementOrElements","_a","element","ownerDocument","body","document","mouseCoords","clientX","clientY","activeInstances","storeMouseCoords","addMouseCoordsListener","doc","addEventListener","removeMouseCoordsListener","removeEventListener","followCursor","name","defaultValue","fn","instance","reference","props","triggerTarget","isInternalUpdate","wasFocusEvent","isUnmounted","prevProps","getIsInitialBehavior","state","isVisible","addListener","onMouseMove","removeListener","unsetGetReferenceClientRect","setProps","getReferenceClientRect","event","isCursorOverReference","target","contains","rect","getBoundingClientRect","relativeX","left","relativeY","top","interactive","x","y","right","bottom","width","height","create","push","destroy","filter","data","length","onCreate","onDestroy","onBeforeUpdate","onAfterUpdate","_","undefined","isMounted","onMount","onTrigger","onHidden"],"mappings":"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"}