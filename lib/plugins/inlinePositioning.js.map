{"version":3,"file":"inlinePositioning.js","sources":["../../src-js/utils.js","../../src-js/dom-utils.js","../../src-js/plugins/inlinePositioning.js"],"sourcesContent":["export function hasOwnProperty(obj, key) {\n    return {}.hasOwnProperty.call(obj, key);\n}\nexport function getValueAtIndexOrReturn(value, index, defaultValue) {\n    if (Array.isArray(value)) {\n        const v = value[index];\n        return v == null\n            ? Array.isArray(defaultValue)\n                ? defaultValue[index]\n                : defaultValue\n            : v;\n    }\n    return value;\n}\nexport function isType(value, type) {\n    const str = {}.toString.call(value);\n    return str.indexOf('[object') === 0 && str.indexOf(`${type}]`) > -1;\n}\nexport function invokeWithArgsOrReturn(value, args) {\n    return typeof value === 'function' ? value(...args) : value;\n}\nexport function debounce(fn, ms) {\n    // Avoid wrapping in `setTimeout` if ms is 0 anyway\n    if (ms === 0) {\n        return fn;\n    }\n    let timeout;\n    return (arg) => {\n        clearTimeout(timeout);\n        timeout = setTimeout(() => {\n            fn(arg);\n        }, ms);\n    };\n}\nexport function removeProperties(obj, keys) {\n    const clone = Object.assign({}, obj);\n    keys.forEach((key) => {\n        delete clone[key];\n    });\n    return clone;\n}\nexport function splitBySpaces(value) {\n    return value.split(/\\s+/).filter(Boolean);\n}\nexport function normalizeToArray(value) {\n    return [].concat(value);\n}\nexport function pushIfUnique(arr, value) {\n    if (arr.indexOf(value) === -1) {\n        arr.push(value);\n    }\n}\nexport function appendPxIfNumber(value) {\n    return typeof value === 'number' ? `${value}px` : value;\n}\nexport function unique(arr) {\n    return arr.filter((item, index) => arr.indexOf(item) === index);\n}\nexport function getNumber(value) {\n    return typeof value === 'number' ? value : parseFloat(value);\n}\nexport function getBasePlacement(placement) {\n    return placement.split('-')[0];\n}\nexport function arrayFrom(value) {\n    return [].slice.call(value);\n}\nexport function removeUndefinedProps(obj) {\n    return Object.keys(obj).reduce((acc, key) => {\n        if (obj[key] !== undefined) {\n            acc[key] = obj[key];\n        }\n        return acc;\n    }, {});\n}\n","import { arrayFrom, isType, normalizeToArray, getBasePlacement } from './utils';\nexport function div() {\n    return document.createElement('div');\n}\nexport function isElement(value) {\n    return ['Element', 'Fragment'].some((type) => isType(value, type));\n}\nexport function isNodeList(value) {\n    return isType(value, 'NodeList');\n}\nexport function isMouseEvent(value) {\n    return isType(value, 'MouseEvent');\n}\nexport function isReferenceElement(value) {\n    return !!(value && value._tippy && value._tippy.reference === value);\n}\nexport function getArrayOfElements(value) {\n    if (isElement(value)) {\n        return [value];\n    }\n    if (isNodeList(value)) {\n        return arrayFrom(value);\n    }\n    if (Array.isArray(value)) {\n        return value;\n    }\n    return arrayFrom(document.querySelectorAll(value));\n}\nexport function setTransitionDuration(els, value) {\n    els.forEach((el) => {\n        if (el) {\n            el.style.transitionDuration = `${value}ms`;\n        }\n    });\n}\nexport function setVisibilityState(els, state) {\n    els.forEach((el) => {\n        if (el) {\n            el.setAttribute('data-state', state);\n        }\n    });\n}\nexport function getOwnerDocument(elementOrElements) {\n    var _a;\n    const [element] = normalizeToArray(elementOrElements);\n    // Elements created via a <template> have an ownerDocument with no reference to the body\n    return ((_a = element === null || element === void 0 ? void 0 : element.ownerDocument) === null || _a === void 0 ? void 0 : _a.body) ? element.ownerDocument : document;\n}\nexport function isCursorOutsideInteractiveBorder(popperTreeData, event) {\n    const { clientX, clientY } = event;\n    return popperTreeData.every(({ popperRect, popperState, props }) => {\n        const { interactiveBorder } = props;\n        const basePlacement = getBasePlacement(popperState.placement);\n        const offsetData = popperState.modifiersData.offset;\n        if (!offsetData) {\n            return true;\n        }\n        const topDistance = basePlacement === 'bottom' ? offsetData.top.y : 0;\n        const bottomDistance = basePlacement === 'top' ? offsetData.bottom.y : 0;\n        const leftDistance = basePlacement === 'right' ? offsetData.left.x : 0;\n        const rightDistance = basePlacement === 'left' ? offsetData.right.x : 0;\n        const exceedsTop = popperRect.top - clientY + topDistance > interactiveBorder;\n        const exceedsBottom = clientY - popperRect.bottom - bottomDistance > interactiveBorder;\n        const exceedsLeft = popperRect.left - clientX + leftDistance > interactiveBorder;\n        const exceedsRight = clientX - popperRect.right - rightDistance > interactiveBorder;\n        return exceedsTop || exceedsBottom || exceedsLeft || exceedsRight;\n    });\n}\nexport function updateTransitionEndListener(box, action, listener) {\n    const method = `${action}EventListener`;\n    // some browsers apparently support `transition` (unprefixed) but only fire\n    // `webkitTransitionEnd`...\n    ['transitionend', 'webkitTransitionEnd'].forEach((event) => {\n        box[method](event, listener);\n    });\n}\n/**\n * Compared to xxx.contains, this function works for dom structures with shadow\n * dom\n */\nexport function actualContains(parent, child) {\n    var _a, _b;\n    let target = child;\n    while (target) {\n        if (parent.contains(target)) {\n            return true;\n        }\n        target = (_b = (_a = target.getRootNode) === null || _a === void 0 ? void 0 : _a.call(target)) === null || _b === void 0 ? void 0 : _b.host;\n    }\n    return false;\n}\n","import { isMouseEvent } from '../dom-utils';\nimport { arrayFrom, getBasePlacement } from '../utils';\nfunction getProps(props, modifier) {\n    var _a;\n    return {\n        popperOptions: Object.assign(Object.assign({}, props.popperOptions), { modifiers: [\n                ...(((_a = props.popperOptions) === null || _a === void 0 ? void 0 : _a.modifiers) || []).filter(({ name }) => name !== modifier.name),\n                modifier,\n            ] }),\n    };\n}\nconst inlinePositioning = {\n    name: 'inlinePositioning',\n    defaultValue: false,\n    fn(instance) {\n        const { reference } = instance;\n        function isEnabled() {\n            return !!instance.props.inlinePositioning;\n        }\n        let placement;\n        let cursorRectIndex = -1;\n        let isInternalUpdate = false;\n        let triedPlacements = [];\n        const modifier = {\n            name: 'tippyInlinePositioning',\n            enabled: true,\n            phase: 'afterWrite',\n            fn({ state }) {\n                if (isEnabled()) {\n                    if (triedPlacements.indexOf(state.placement) !== -1) {\n                        triedPlacements = [];\n                    }\n                    if (placement !== state.placement &&\n                        triedPlacements.indexOf(state.placement) === -1) {\n                        triedPlacements.push(state.placement);\n                        instance.setProps({\n                            // @ts-ignore - unneeded DOMRect properties\n                            getReferenceClientRect: () => getReferenceClientRect(state.placement),\n                        });\n                    }\n                    placement = state.placement;\n                }\n            },\n        };\n        function getReferenceClientRect(placement) {\n            return getInlineBoundingClientRect(getBasePlacement(placement), reference.getBoundingClientRect(), arrayFrom(reference.getClientRects()), cursorRectIndex);\n        }\n        function setInternalProps(partialProps) {\n            isInternalUpdate = true;\n            instance.setProps(partialProps);\n            isInternalUpdate = false;\n        }\n        function addModifier() {\n            if (!isInternalUpdate) {\n                setInternalProps(getProps(instance.props, modifier));\n            }\n        }\n        return {\n            onCreate: addModifier,\n            onAfterUpdate: addModifier,\n            onTrigger(_, event) {\n                if (isMouseEvent(event)) {\n                    const rects = arrayFrom(instance.reference.getClientRects());\n                    const cursorRect = rects.find((rect) => rect.left - 2 <= event.clientX &&\n                        rect.right + 2 >= event.clientX &&\n                        rect.top - 2 <= event.clientY &&\n                        rect.bottom + 2 >= event.clientY);\n                    const index = rects.indexOf(cursorRect);\n                    cursorRectIndex = index > -1 ? index : cursorRectIndex;\n                }\n            },\n            onHidden() {\n                cursorRectIndex = -1;\n            },\n        };\n    },\n};\nexport default inlinePositioning;\nexport function getInlineBoundingClientRect(currentBasePlacement, boundingRect, clientRects, cursorRectIndex) {\n    // Not an inline element, or placement is not yet known\n    if (clientRects.length < 2 || currentBasePlacement === null) {\n        return boundingRect;\n    }\n    // There are two rects and they are disjoined\n    if (clientRects.length === 2 &&\n        cursorRectIndex >= 0 &&\n        clientRects[0].left > clientRects[1].right) {\n        return clientRects[cursorRectIndex] || boundingRect;\n    }\n    switch (currentBasePlacement) {\n        case 'top':\n        case 'bottom': {\n            const firstRect = clientRects[0];\n            const lastRect = clientRects[clientRects.length - 1];\n            const isTop = currentBasePlacement === 'top';\n            const top = firstRect.top;\n            const bottom = lastRect.bottom;\n            const left = isTop ? firstRect.left : lastRect.left;\n            const right = isTop ? firstRect.right : lastRect.right;\n            const width = right - left;\n            const height = bottom - top;\n            return { top, bottom, left, right, width, height };\n        }\n        case 'left':\n        case 'right': {\n            const minLeft = Math.min(...clientRects.map((rects) => rects.left));\n            const maxRight = Math.max(...clientRects.map((rects) => rects.right));\n            const measureRects = clientRects.filter((rect) => currentBasePlacement === 'left'\n                ? rect.left === minLeft\n                : rect.right === maxRight);\n            const top = measureRects[0].top;\n            const bottom = measureRects[measureRects.length - 1].bottom;\n            const left = minLeft;\n            const right = maxRight;\n            const width = right - left;\n            const height = bottom - top;\n            return { top, bottom, left, right, width, height };\n        }\n        default: {\n            return boundingRect;\n        }\n    }\n}\n"],"names":["isType","value","type","str","toString","call","indexOf","getBasePlacement","placement","split","arrayFrom","slice","isMouseEvent","getProps","props","modifier","_a","popperOptions","Object","assign","modifiers","filter","name","inlinePositioning","defaultValue","fn","instance","reference","isEnabled","cursorRectIndex","isInternalUpdate","triedPlacements","enabled","phase","state","push","setProps","getReferenceClientRect","getInlineBoundingClientRect","getBoundingClientRect","getClientRects","setInternalProps","partialProps","addModifier","onCreate","onAfterUpdate","onTrigger","_","event","rects","cursorRect","find","rect","left","clientX","right","top","clientY","bottom","index","onHidden","currentBasePlacement","boundingRect","clientRects","length","firstRect","lastRect","isTop","width","height","minLeft","Math","min","map","maxRight","max","measureRects"],"mappings":"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"}